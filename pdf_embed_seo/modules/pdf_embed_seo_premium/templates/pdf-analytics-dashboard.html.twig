{#
/**
 * @file
 * Template for PDF analytics dashboard (premium feature).
 *
 * Available variables:
 * - total_views: Total number of PDF views.
 * - total_documents: Total number of PDF documents.
 * - popular_documents: Array of popular documents with view counts.
 * - recent_views: Array of recent view records.
 * - period: Selected time period.
 */
#}
<div class="pdf-analytics-dashboard">
  {# Period selector #}
  <div class="pdf-analytics-period">
    <form method="get" class="pdf-analytics-period-form">
      <label for="period">{{ 'Time Period:'|t }}</label>
      <select name="period" id="period" onchange="this.form.submit()">
        <option value="7days"{% if period == '7days' %} selected{% endif %}>{{ 'Last 7 Days'|t }}</option>
        <option value="30days"{% if period == '30days' %} selected{% endif %}>{{ 'Last 30 Days'|t }}</option>
        <option value="90days"{% if period == '90days' %} selected{% endif %}>{{ 'Last 90 Days'|t }}</option>
        <option value="12months"{% if period == '12months' %} selected{% endif %}>{{ 'Last 12 Months'|t }}</option>
        <option value="all"{% if period == 'all' %} selected{% endif %}>{{ 'All Time'|t }}</option>
      </select>
    </form>
  </div>

  {# Overview cards #}
  <div class="pdf-analytics-overview">
    <div class="pdf-analytics-card">
      <div class="pdf-analytics-card-value">{{ total_views }}</div>
      <div class="pdf-analytics-card-label">{{ 'Total Views'|t }}</div>
    </div>
    <div class="pdf-analytics-card">
      <div class="pdf-analytics-card-value">{{ total_documents }}</div>
      <div class="pdf-analytics-card-label">{{ 'PDF Documents'|t }}</div>
    </div>
    <div class="pdf-analytics-card">
      <div class="pdf-analytics-card-value">
        {% if total_documents > 0 %}
          {{ (total_views / total_documents)|round(1) }}
        {% else %}
          0
        {% endif %}
      </div>
      <div class="pdf-analytics-card-label">{{ 'Avg. Views/Document'|t }}</div>
    </div>
  </div>

  {# Export button #}
  <div class="pdf-analytics-actions">
    <a href="{{ path('pdf_embed_seo_premium.analytics_export') }}" class="button">
      {{ 'Export to CSV'|t }}
    </a>
  </div>

  <div class="pdf-analytics-content">
    {# Popular documents #}
    <div class="pdf-analytics-section">
      <h3>{{ 'Popular Documents'|t }}</h3>
      {% if popular_documents %}
        <table class="pdf-analytics-table">
          <thead>
            <tr>
              <th>{{ 'Document'|t }}</th>
              <th>{{ 'Views'|t }}</th>
            </tr>
          </thead>
          <tbody>
            {% for item in popular_documents %}
              <tr>
                <td>
                  <a href="{{ path('entity.pdf_document.canonical', {'pdf_document': item.document.id}) }}">
                    {{ item.document.title.value }}
                  </a>
                </td>
                <td>{{ item.views }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p>{{ 'No view data available.'|t }}</p>
      {% endif %}
    </div>

    {# Recent views #}
    <div class="pdf-analytics-section">
      <h3>{{ 'Recent Views'|t }}</h3>
      {% if recent_views %}
        <table class="pdf-analytics-table">
          <thead>
            <tr>
              <th>{{ 'Document'|t }}</th>
              <th>{{ 'User'|t }}</th>
              <th>{{ 'Date/Time'|t }}</th>
              <th>{{ 'IP Address'|t }}</th>
            </tr>
          </thead>
          <tbody>
            {% for view in recent_views %}
              <tr>
                <td>
                  <a href="{{ path('entity.pdf_document.canonical', {'pdf_document': view.document.id}) }}">
                    {{ view.document.title.value }}
                  </a>
                </td>
                <td>
                  {% if view.user %}
                    {{ view.user.name.value }}
                  {% else %}
                    {{ 'Anonymous'|t }}
                  {% endif %}
                </td>
                <td>{{ view.timestamp|date('M j, Y g:i a') }}</td>
                <td>{{ view.ip_address }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p>{{ 'No recent views.'|t }}</p>
      {% endif %}
    </div>
  </div>

  {# Credit link #}
  <p class="pdf-embed-seo-credit" style="text-align: center; margin-top: 30px; color: #666; font-size: 13px;">
    {{ 'made with'|t }} <span style="color: #e25555;" aria-hidden="true">&#9829;</span><span class="visually-hidden">{{ 'love'|t }}</span> {{ 'by'|t }} <a href="https://dross.net/media/" target="_blank" rel="noopener noreferrer" aria-label="{{ 'Visit Dross:Media website (opens in new tab)'|t }}" title="{{ 'Visit Dross:Media website'|t }}">Dross:Media</a>
  </p>
</div>

<style>
  .pdf-analytics-dashboard {
    padding: 20px 0;
  }

  .pdf-analytics-period {
    margin-bottom: 20px;
  }

  .pdf-analytics-period-form {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .pdf-analytics-period select {
    padding: 8px 12px;
    border-radius: 4px;
    border: 1px solid #ddd;
  }

  .pdf-analytics-overview {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }

  .pdf-analytics-card {
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 20px;
    text-align: center;
  }

  .pdf-analytics-card-value {
    font-size: 36px;
    font-weight: bold;
    color: #0073aa;
  }

  .pdf-analytics-card-label {
    font-size: 14px;
    color: #666;
    margin-top: 5px;
  }

  .pdf-analytics-actions {
    margin-bottom: 30px;
  }

  .pdf-analytics-content {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 30px;
  }

  .pdf-analytics-section {
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 20px;
  }

  .pdf-analytics-section h3 {
    margin-top: 0;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid #eee;
  }

  .pdf-analytics-table {
    width: 100%;
    border-collapse: collapse;
  }

  .pdf-analytics-table th,
  .pdf-analytics-table td {
    padding: 10px;
    text-align: left;
    border-bottom: 1px solid #eee;
  }

  .pdf-analytics-table th {
    font-weight: 600;
    background: #f9f9f9;
  }

  .pdf-analytics-table tr:hover {
    background: #f5f5f5;
  }
</style>
